(this["webpackJsonpreact_dynamic-list-of-posts"]=this["webpackJsonpreact_dynamic-list-of-posts"]||[]).push([[0],{19:function(e,t,s){},22:function(e,t,s){},23:function(e,t,s){"use strict";s.r(t);var n=s(10),c=s.n(n),a=s(1),i=s.n(a),o=(s(17),s(18),s(19),s(4)),r=s.n(o),l=s(2),d="https://mate.academy/students-api";function m(e){return new Promise((function(t){setTimeout(t,e)}))}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:t};return s&&(n.body=JSON.stringify(s),n.headers={"Content-Type":"application/json; charset=UTF-8"}),m(300).then((function(){return fetch(d+e,n)})).then((function(e){return e.json()}))}var u=function(e){return j(e)},b=function(e,t){return j(e,"POST",t)},O=function(e){return j(e,"DELETE")},h=s(11),x=s(9),f=s.n(x),p=s(0),v={users:[],setUsers:function(){},selectedUser:null,setSelectedUser:function(){}},N=i.a.createContext(v),y=function(e){var t=e.children,s=Object(a.useState)([]),n=Object(l.a)(s,2),c=n[0],i=n[1],o=Object(a.useState)(null),r=Object(l.a)(o,2),d=r[0],m=r[1],j=function(){var e=Object(h.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u("/users");case 3:t=e.sent,i(t),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),new Error("Failed to load users");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){j()}),[]);var b={users:c,setUsers:i,selectedUser:d,setSelectedUser:m};return Object(p.jsx)(N.Provider,{value:b,children:t})},C={posts:[],setPosts:function(){},hasPostsError:!1,setHasPostsError:function(){},isLoadingPosts:!1,setIsLoadingPosts:function(){},selectedPost:null,setSelectedPost:function(){}},g=i.a.createContext(C),P=function(e){var t=e.children,s=Object(a.useState)([]),n=Object(l.a)(s,2),c=n[0],i=n[1],o=Object(a.useState)(!1),r=Object(l.a)(o,2),d=r[0],m=r[1],j=Object(a.useState)(!1),b=Object(l.a)(j,2),O=b[0],h=b[1],x=Object(a.useState)(null),f=Object(l.a)(x,2),v=f[0],y=f[1],C=Object(a.useContext)(N).selectedUser;Object(a.useEffect)((function(){var e;C&&(h(!0),(e=C.id,u("/posts?userId=".concat(e))).then((function(e){return i(e)})).catch((function(){return m(!0)})).finally((function(){return h(!1)})))}),[C]);var P={posts:c,setPosts:i,hasPostsError:d,setHasPostsError:m,isLoadingPosts:O,setIsLoadingPosts:h,selectedPost:v,setSelectedPost:y};return Object(p.jsx)(g.Provider,{value:P,children:t})},S=s(12),w={comments:[],setComments:function(){},isLoadingComments:!1,setIsLoadingComments:function(){},hasCommentsError:!1,setHasCommentsError:function(){},submitNewComment:function(){},isSubmittingComment:!1,setisSubmittingComment:function(){},deleteComment:function(){},isOpenNewCommentForm:!1,setIsOpenNewCommentForm:function(){}},E=i.a.createContext(w),k=function(e){var t=e.children,s=Object(a.useState)([]),n=Object(l.a)(s,2),c=n[0],i=n[1],o=Object(a.useState)(!1),r=Object(l.a)(o,2),d=r[0],m=r[1],j=Object(a.useState)(!1),h=Object(l.a)(j,2),x=h[0],f=h[1],v=Object(a.useState)(!1),N=Object(l.a)(v,2),y=N[0],C=N[1],P=Object(a.useState)(!1),w=Object(l.a)(P,2),k=w[0],I=w[1],F=Object(a.useContext)(g).selectedPost;Object(a.useEffect)((function(){var e;F&&(m(!0),(e=F.id,u("/comments?postId=".concat(e))).then((function(e){return i(e)})).catch((function(){return f(!0)})).finally((function(){return m(!1)})))}),[F]);var L={comments:c,setComments:i,isLoadingComments:d,setIsLoadingComments:m,hasCommentsError:x,setHasCommentsError:f,submitNewComment:function(e){var t=e.postId,s=e.name,n=e.email,c=e.body;C(!0),function(e){var t=e.postId,s=e.name,n=e.email,c=e.body;return b("/comments",{postId:t,name:s,email:n,body:c})}({postId:t,name:s,email:n,body:c}).then((function(e){return i((function(t){return[].concat(Object(S.a)(t),[e])}))})).finally((function(){return C(!1)}))},isSubmittingComment:y,setisSubmittingComment:C,deleteComment:function(e){i((function(t){return t.filter((function(t){return t.id!==e}))})),function(e){return O("/comments/".concat(e))}(e).catch((function(){return i(c)}))},isOpenNewCommentForm:k,setIsOpenNewCommentForm:I};return Object(p.jsx)(E.Provider,{value:L,children:t})},I=function(e){var t=e.post,s=t.id,n=t.title,c=Object(a.useContext)(g),i=c.selectedPost,o=c.setSelectedPost,l=Object(a.useContext)(E).setIsOpenNewCommentForm;return Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("tr",{"data-cy":"Post",children:[Object(p.jsx)("td",{"data-cy":"PostId",children:s}),Object(p.jsx)("td",{"data-cy":"PostTitle",children:n}),Object(p.jsx)("td",{className:"has-text-right is-vcentered",children:Object(p.jsx)("button",{type:"button","data-cy":"PostButton",className:r()("button is-link",{"is-light":(null===i||void 0===i?void 0:i.id)!==s}),onClick:function(){i&&i.id===s?o(null):o(t),l(!1)},children:(null===i||void 0===i?void 0:i.id)===s?"Close":"Open"})})]})})},F=function(){var e=Object(a.useContext)(g).posts;return Object(p.jsxs)("div",{"data-cy":"PostsList",children:[Object(p.jsx)("p",{className:"title",children:"Posts:"}),Object(p.jsxs)("table",{className:"table is-fullwidth is-striped is-hoverable is-narrow",children:[Object(p.jsx)("thead",{children:Object(p.jsxs)("tr",{className:"has-background-link-light",children:[Object(p.jsx)("th",{children:"#"}),Object(p.jsx)("th",{children:"Title"}),Object(p.jsx)("th",{children:" "})]})}),Object(p.jsx)("tbody",{children:e.map((function(e){return Object(p.jsx)(I,{post:e},e.id)}))})]})]})},L=(s(22),function(){return Object(p.jsx)("div",{className:"Loader","data-cy":"Loader",children:Object(p.jsx)("div",{className:"Loader__content"})})}),U=function(e){var t=e.comment,s=t.id,n=t.name,c=t.email,i=t.body,o=Object(a.useContext)(E).deleteComment;return Object(p.jsxs)("article",{className:"message is-small","data-cy":"Comment",children:[Object(p.jsxs)("div",{className:"message-header",children:[Object(p.jsx)("a",{href:"mailto:".concat(c),"data-cy":"CommentAuthor",children:n}),Object(p.jsx)("button",{"data-cy":"CommentDelete",type:"button",className:"delete is-small","aria-label":"delete",onClick:function(){return o(s)},children:"delete button"})]}),Object(p.jsx)("div",{className:"message-body","data-cy":"CommentBody",children:i})]})},T=function(){var e=Object(a.useContext)(E).comments;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("p",{className:"title is-4",children:"Comments:"}),e.map((function(e){return Object(p.jsx)(U,{comment:e},e.id)}))]})},B=s(6),D=s(3),M=function(e){var t=e.selectedPost,s=Object(a.useContext)(E),n=s.submitNewComment,c=s.isSubmittingComment,i=Object(a.useState)({name:"",email:"",body:""}),o=Object(l.a)(i,2),d=o[0],m=o[1],j=Object(a.useState)({name:!1,email:!1,body:!1}),u=Object(l.a)(j,2),b=u[0],O=u[1],h=d.name,x=d.email,f=d.body,v=function(e){var t=e.target,s=t.name,n=t.value;O((function(e){return Object(D.a)(Object(D.a)({},e),{},Object(B.a)({},s,!1))})),m((function(e){return Object(D.a)(Object(D.a)({},e),{},Object(B.a)({},s,n))}))};return Object(p.jsxs)("form",{"data-cy":"NewCommentForm",onSubmit:function(e){e.preventDefault();var s=h.trim(),c=f.trim(),a=x.trim();s||O((function(e){return Object(D.a)(Object(D.a)({},e),{},{name:!0})})),c||O((function(e){return Object(D.a)(Object(D.a)({},e),{},{body:!0})})),a||O((function(e){return Object(D.a)(Object(D.a)({},e),{},{email:!0})})),h&&x&&f&&(n({postId:t.id,name:s,email:a,body:c}),m((function(e){return Object(D.a)(Object(D.a)({},e),{},{body:""})})))},children:[Object(p.jsxs)("div",{className:"field","data-cy":"NameField",children:[Object(p.jsx)("label",{className:"label",htmlFor:"comment-author-name",children:"Author Name"}),Object(p.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(p.jsx)("input",{type:"text",name:"name",id:"comment-author-name",placeholder:"Name Surname",className:r()("input",{"is-danger":b.name}),value:h,onChange:v}),Object(p.jsx)("span",{className:"icon is-small is-left",children:Object(p.jsx)("i",{className:"fas fa-user"})}),b.name&&Object(p.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(p.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),b.name&&Object(p.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Name is required"})]}),Object(p.jsxs)("div",{className:"field","data-cy":"EmailField",children:[Object(p.jsx)("label",{className:"label",htmlFor:"comment-author-email",children:"Author Email"}),Object(p.jsxs)("div",{className:"control has-icons-left has-icons-right",children:[Object(p.jsx)("input",{type:"text",name:"email",id:"comment-author-email",placeholder:"email@test.com",className:r()("input",{"is-danger":b.email}),value:x,onChange:v}),Object(p.jsx)("span",{className:"icon is-small is-left",children:Object(p.jsx)("i",{className:"fas fa-envelope"})}),b.email&&Object(p.jsx)("span",{className:"icon is-small is-right has-text-danger","data-cy":"ErrorIcon",children:Object(p.jsx)("i",{className:"fas fa-exclamation-triangle"})})]}),b.email&&Object(p.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Email is required"})]}),Object(p.jsxs)("div",{className:"field","data-cy":"BodyField",children:[Object(p.jsx)("label",{className:"label",htmlFor:"comment-body",children:"Comment Text"}),Object(p.jsx)("div",{className:"control",children:Object(p.jsx)("textarea",{id:"comment-body",name:"body",placeholder:"Type comment here",className:r()("textarea",{"is-danger":b.body}),value:f,onChange:v})}),b.body&&Object(p.jsx)("p",{className:"help is-danger","data-cy":"ErrorMessage",children:"Enter some text"})]}),Object(p.jsxs)("div",{className:"field is-grouped",children:[Object(p.jsx)("div",{className:"control",children:Object(p.jsx)("button",{type:"submit",className:r()("button is-link",{"is-loading":c}),children:"Add"})}),Object(p.jsx)("div",{className:"control",children:Object(p.jsx)("button",{type:"reset",className:"button is-link is-light",onClick:function(){m({name:"",email:"",body:""}),O({name:!1,email:!1,body:!1})},children:"Clear"})})]})]})},A=function(){var e=Object(a.useContext)(g).selectedPost,t=Object(a.useContext)(E),s=t.comments,n=t.isLoadingComments,c=t.hasCommentsError,i=t.isOpenNewCommentForm,o=t.setIsOpenNewCommentForm,r=!n&&!c&&!s.length;return Object(p.jsx)("div",{className:"content","data-cy":"PostDetails",children:Object(p.jsxs)("div",{className:"content","data-cy":"PostDetails",children:[Object(p.jsxs)("div",{className:"block",children:[Object(p.jsx)("h2",{"data-cy":"PostTitle",children:"#".concat(null===e||void 0===e?void 0:e.id,": ").concat(null===e||void 0===e?void 0:e.title)}),Object(p.jsx)("p",{"data-cy":"PostBody",children:null===e||void 0===e?void 0:e.body})]}),Object(p.jsxs)("div",{className:"block",children:[n&&Object(p.jsx)(L,{}),c&&Object(p.jsx)("div",{className:"notification is-danger","data-cy":"CommentsError",children:"Something went wrong"}),r&&Object(p.jsx)("p",{className:"title is-4","data-cy":"NoCommentsMessage",children:"No comments yet"}),!!s.length&&Object(p.jsx)(T,{}),i&&e?Object(p.jsx)(M,{selectedPost:e}):Object(p.jsx)("div",{className:"block",children:Object(p.jsx)("button",{"data-cy":"WriteCommentButton",type:"button",className:"button is-link",onClick:function(){return o(!0)},children:"Write a comment"})})]})]})})},H=function(){var e=Object(a.useContext)(N),t=e.users,s=e.selectedUser,n=e.setSelectedUser,c=Object(a.useState)(!1),i=Object(l.a)(c,2),o=i[0],d=i[1],m=s?s.name:"Choose a user";return Object(p.jsxs)("div",{"data-cy":"UserSelector",className:r()("dropdown",{"is-active":o}),children:[Object(p.jsx)("div",{className:"dropdown-trigger",children:Object(p.jsxs)("button",{type:"button",className:"button","aria-haspopup":"true","aria-controls":"dropdown-menu",onClick:function(){return d(!o)},children:[Object(p.jsx)("span",{children:m}),Object(p.jsx)("span",{className:"icon is-small",children:Object(p.jsx)("i",{className:"fas fa-angle-down","aria-hidden":"true"})})]})}),Object(p.jsx)("div",{className:"dropdown-menu",id:"dropdown-menu",role:"menu",children:Object(p.jsx)("div",{className:"dropdown-content",children:t.map((function(e){return Object(p.jsx)("a",{href:"#$user-".concat(e.id),className:r()("dropdown-item",{"is-active":e.id===(null===s||void 0===s?void 0:s.id)}),onClick:function(){return function(e){n(e),d(!1)}(e)},children:e.name},e.id)}))})})]})},_=function(){var e=Object(a.useContext)(N).selectedUser,t=Object(a.useContext)(g),s=t.posts,n=t.hasPostsError,c=t.isLoadingPosts,i=t.selectedPost,o=e&&!c&&!n&&!s.length;return Object(p.jsx)("main",{className:"section",children:Object(p.jsx)("div",{className:"container",children:Object(p.jsxs)("div",{className:"tile is-ancestor",children:[Object(p.jsx)("div",{className:"tile is-parent",children:Object(p.jsxs)("div",{className:"tile is-child box is-success",children:[Object(p.jsx)("div",{className:"block",children:Object(p.jsx)(H,{})}),Object(p.jsxs)("div",{className:"block","data-cy":"MainContent",children:[!e&&Object(p.jsx)("p",{"data-cy":"NoSelectedUser",children:"No user selected"}),c&&Object(p.jsx)(L,{}),n&&Object(p.jsx)("div",{className:"notification is-danger","data-cy":"PostsLoadingError",children:"Something went wrong!"}),!!s.length&&Object(p.jsx)(F,{}),o&&Object(p.jsx)("div",{className:"notification is-warning","data-cy":"NoPostsYet",children:"No posts yet"})]})]})}),Object(p.jsx)("div",{"data-cy":"Sidebar",className:r()("tile","is-parent","is-8-desktop","Sidebar",{"Sidebar--open":i}),children:Object(p.jsx)("div",{className:"tile is-child box is-success ",children:i&&Object(p.jsx)(A,{})})})]})})})};c.a.render(Object(p.jsx)(y,{children:Object(p.jsx)(P,{children:Object(p.jsx)(k,{children:Object(p.jsx)(_,{})})})}),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.41f5898d.chunk.js.map